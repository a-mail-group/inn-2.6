.\" Automatically generated by Pod::Man 4.07 (Pod::Simple 3.32)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is >0, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.if !\nF .nr F 0
.if \nF>0 \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    if !\nF==2 \{\
.        nr % 0
.        nr F 2
.    \}
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "INNBIND 8"
.TH INNBIND 8 "2015-09-12" "INN 2.6.3" "InterNetNews Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
innbind \- Helper program to bind sockets to privileged ports
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
\&\fBinnbind\fR [\fB\-p\fR] \fIfd\fR,\fIfamily\fR,\fIaddress\fR,\fIport\fR [...]
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
\&\fBinnbind\fR is a helper program that's not meant to be run directly.
Instead, \fBinnd\fR and \fBnnrpd\fR use it internally to bind to ports that
require root privileges to bind to.
.PP
This program must be installed setuid root in order for \fBinnd\fR or
\&\fBnnrpd\fR to bind to ports under 1024.  The only functions that it's
willing to perform are to bind an open file descriptor to a given address
and port or to create a new socket, bind it, and return the bound socket
to its caller.  It can only be run as the news user (as specified at
configure time), and will only bind to ports 119, 433, 563, an additional port
specified with the \fB\-\-with\-innd\-port\fR argument to configure, or ports
numbered 1024 or higher.
.PP
Each argument to \fBinnbind\fR must be a comma-separated list of four
elements.  The first is the file descriptor number that should be bound,
the second is the numeric family of the socket (\s-1AF_INET\s0 or \s-1AF_INET6\s0), the
third is the local address to bind to (in dotted-quad format for IPv4 and
in colon-separated address format for IPv6), and the fourth is the port
number.  To bind to all addresses with IPv4, use \f(CW0.0.0.0\fR as the
address.  To bind to all addresses with IPv6, use \f(CW\*(C`::\*(C'\fR as the address.
.PP
Multiple arguments can be specified to tell \fBinnbind\fR to bind multiple
sockets at the same time.  Any errors (other than permission denied \-\-\ see
below) encountered will cause \fBinnbind\fR to abort, and error messages will
be sent both to syslog and to standard error.
.PP
By default, \fBinnbind\fR attempts to just bind the already open file
descriptor that it inherits from its caller.  For each successfully bound
file descriptor (in the order given on the command line), \fBinnbind\fR
prints \f(CW\*(C`ok\*(C'\fR and a newline to its standard output.
.PP
On some systems (apparently just STREAMS-based systems), however, even a
setuid root program cannot bind a socket to a privileged port that was
created by a process that didn't have permissions.  If \fBinnbind\fR gets
permission denied when trying to bind a socket, it will print \f(CW\*(C`no\*(C'\fR and a
newline to its standard output.  It will then create a new socket, bind it
as specified, and then attempt to pass that socket back to its caller
using the I_SENDFD \s-1STREAMS\s0 ioctl.  The caller should receive that file
descriptor with I_RECVFD and use it instead of the one that it created.
.PP
Note that file descriptor passing is only supported on STREAMS-based
systems since it is done with ioctls over a pipe.  However, it is believed
that those systems are exactly the systems that can't simply bind the
inherited file descriptor.  If this assumption proves to be incorrect,
traditional \s-1BSD\s0 file descriptor passing over a Unix domain socket will
have to be added.
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\fB\-p\fR" 4
.IX Item "-p"
If given as the first command-line argument, no attempt will be made to
bind the inherited file descriptor and \fBinnbind\fR will only try creation
of a new file descriptor and passing it back via standard output.  This
option is primarily useful for testing.
.SH "SECURITY"
.IX Header "SECURITY"
As \fBinnbind\fR is normally installed setuid root, security is even more of
an issue for it than for other parts of \s-1INN. \s0 It is a fairly short
program, and if you understand C, you are encouraged to audit it yourself
to be certain that it does only what it is supposed to do.  The only \s-1INN\s0
library functions it uses are the vector functions, the message functions
for error reporting, and xstrdup.
.PP
The ports that will be bound are restricted to prevent potential attacks
made possible by the ability to bind low-numbered ports, such as exploits
of the \fIrsh\fR\|(1) family of commands on some systems.  If \fBinnbind\fR is
installed setuid root, it can only be executed by the news user to prevent
other users on the system from being able to bind to even those few
privileged ports that it allows.
.PP
\&\fBinnbind\fR uses no external configuration files; the only files it might
open are through the system \fIgetpwnam\fR\|(3) service to get the \s-1UID\s0 of the news
user.  The only user input that it accepts are its command-line arguments.
.SH "DIAGNOSTICS"
.IX Header "DIAGNOSTICS"
\&\fBinnbind\fR may log the following messages to syslog and print them to
standard error.
.ie n .IP "cannot create socket for %s: %s" 4
.el .IP "cannot create socket for \f(CW%s:\fR \f(CW%s\fR" 4
.IX Item "cannot create socket for %s: %s"
(Fatal) \fBinnbind\fR fell back on attempting to create a new socket to bind
for the given argument, and the socket creation failed.
.ie n .IP "cannot bind socket for %s: %s" 4
.el .IP "cannot bind socket for \f(CW%s:\fR \f(CW%s\fR" 4
.IX Item "cannot bind socket for %s: %s"
(Fatal) Calling bind for the socket corresponding to the given argument
failed with a system error.  If the error indicates permission denied,
make sure that \fBinnbind\fR is setuid root.  This can also be caused by
trying to use IPv6 on a system whose kernel does not support it.
.ie n .IP "cannot bind to restricted port %hu in %s" 4
.el .IP "cannot bind to restricted port \f(CW%hu\fR in \f(CW%s\fR" 4
.IX Item "cannot bind to restricted port %hu in %s"
(Fatal) The port number portion of the given command-line argument is for
a port below 1024 which is not 119, 433, 563, or a port given to
\&\fB\-\-with\-innd\-port\fR at configure time.  Other ports are not allowed for
security reasons.
.ie n .IP "cannot get socket options for file descriptor %d: %s" 4
.el .IP "cannot get socket options for file descriptor \f(CW%d:\fR \f(CW%s\fR" 4
.IX Item "cannot get socket options for file descriptor %d: %s"
(Fatal) \fBinnbind\fR was unable to get the socket options for that file
descriptor.  The most likely cause of this error is passing the wrong file
descriptor number to \fBinnbind\fR (a file descriptor that isn't open, or
that corresponds to a regular file rather than a network socket).
.ie n .IP "cannot get \s-1UID\s0 for %s" 4
.el .IP "cannot get \s-1UID\s0 for \f(CW%s\fR" 4
.IX Item "cannot get UID for %s"
(Fatal) \fBinnbind\fR was unable to get the \s-1UID\s0 for the news user specified
during configure (and defaulting to \f(CW\*(C`news\*(C'\fR).  This normally means that
user isn't in the system \fIpasswd\fR file.
.ie n .IP "cannot mark socket reusable for %s: %s" 4
.el .IP "cannot mark socket reusable for \f(CW%s:\fR \f(CW%s\fR" 4
.IX Item "cannot mark socket reusable for %s: %s"
(Fatal) \fBinnbind\fR created a new socket for the given argument but was
unable to mark its bind address reusable (the \s-1SO_REUSEADDR\s0 socket option).
.ie n .IP "cannot pass file descriptor: %s" 4
.el .IP "cannot pass file descriptor: \f(CW%s\fR" 4
.IX Item "cannot pass file descriptor: %s"
(Fatal) \fBinnbind\fR created and bound a new file descriptor but was unable
to pass it back to its caller via its standard output, using the I_SENDFD
\&\s-1STREAMS\s0 ioctl.
.ie n .IP "invalid file descriptor %d: not \s-1SOCK_STREAM\s0" 4
.el .IP "invalid file descriptor \f(CW%d:\fR not \s-1SOCK_STREAM\s0" 4
.IX Item "invalid file descriptor %d: not SOCK_STREAM"
(Fatal) The given file descriptor is not a \s-1SOCK_STREAM\s0 socket.  \fBinnbind\fR
can only bind \s-1SOCK_STREAM\s0 sockets.
.ie n .IP "invalid IPv4 address %s in %s" 4
.el .IP "invalid IPv4 address \f(CW%s\fR in \f(CW%s\fR" 4
.IX Item "invalid IPv4 address %s in %s"
(Fatal) The IPv4 address specified in the given command-line option could
not be parsed by \fIinet_aton\fR\|(3).  IPv4 addresses should be specified in the
standard dotted-quad format (10.2.3.4).
.ie n .IP "invalid IPv6 address %s in %s" 4
.el .IP "invalid IPv6 address \f(CW%s\fR in \f(CW%s\fR" 4
.IX Item "invalid IPv6 address %s in %s"
(Fatal) The IPv6 address specified in the given command-line option could
not be parsed by \fIinet_pton\fR\|(3).  IPv6 addresses should be specified in
\&\s-1RFC\s0\ 4291 format (1080:0:0:0:8:800:200C:417A or 1080::8:800:200C:417A).
.ie n .IP "invalid command-line argument %s" 4
.el .IP "invalid command-line argument \f(CW%s\fR" 4
.IX Item "invalid command-line argument %s"
(Fatal) The specified command-line argument could not be parsed or was not
in the correct format.
.ie n .IP "invalid file descriptor %s in %s" 4
.el .IP "invalid file descriptor \f(CW%s\fR in \f(CW%s\fR" 4
.IX Item "invalid file descriptor %s in %s"
(Fatal) The file descriptor portion of the given command-line argument is
not a non-negative integer.
.ie n .IP "invalid port number %s in %s" 4
.el .IP "invalid port number \f(CW%s\fR in \f(CW%s\fR" 4
.IX Item "invalid port number %s in %s"
(Fatal) The port number portion of the given command-line argument is not
a non-negative integer.
.ie n .IP "invalid protocol family %s in %s" 4
.el .IP "invalid protocol family \f(CW%s\fR in \f(CW%s\fR" 4
.IX Item "invalid protocol family %s in %s"
(Fatal) The protocol family portion of the given command-line argument is
not a non-negative integer.  It should be equal to either \s-1AF_INET\s0 or
\&\s-1AF_INET6\s0 on the system where \fBinnbind\fR is run.
.ie n .IP "must be run by user %s (%lu), not %lu" 4
.el .IP "must be run by user \f(CW%s\fR (%lu), not \f(CW%lu\fR" 4
.IX Item "must be run by user %s (%lu), not %lu"
(Fatal) When setuid root, \fBinnbind\fR may only be run by the news user as
specified at configure time (\f(CW\*(C`news\*(C'\fR by default), for security reasons.
.IP "no addresses specified" 4
.IX Item "no addresses specified"
(Fatal) No arguments were given on the command line (except maybe \fB\-p\fR).
.ie n .IP "port may not be zero in %s" 4
.el .IP "port may not be zero in \f(CW%s\fR" 4
.IX Item "port may not be zero in %s"
(Fatal) The port number portion of the given command-line argument was
zero.
.ie n .IP "unknown protocol family %s in %s" 4
.el .IP "unknown protocol family \f(CW%s\fR in \f(CW%s\fR" 4
.IX Item "unknown protocol family %s in %s"
(Fatal) The protocol number portion of the given command-line argument is
neither \s-1AF_INET\s0 nor \s-1AF_INET6.\s0
.SH "EXAMPLES"
.IX Header "EXAMPLES"
As mentioned above, \fBinnbind\fR is never run directly, only by \fBinnd\fR and
other programs that need to bind to and listen to network ports.  Sample
invocations by \fBinnd\fR would be:
.PP
.Vb 1
\&    innbind 3,10,::,119
.Ve
.PP
to bind the IPv6 socket on file descriptor 3 to port 119, all addresses,
or:
.PP
.Vb 1
\&    innbind 6,2,10.0.0.3,433
.Ve
.PP
to bind the IPv4 socket on file descriptor 6 to port 433 in the address
10.0.0.3.
.SH "HISTORY"
.IX Header "HISTORY"
Written by Russ Allbery <eagle@eyrie.org> for InterNetNews.
.PP
\&\f(CW$Id:\fR innbind.pod 9767 2014\-12\-07 21:13:43Z iulius $
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIinet_aton\fR\|(3), \fIinet_pton\fR\|(3), \fIinnd\fR\|(8), \fInnrpd\fR\|(8).
