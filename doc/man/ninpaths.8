.\" Automatically generated by Pod::Man 4.07 (Pod::Simple 3.32)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is >0, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.if !\nF .nr F 0
.if \nF>0 \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    if !\nF==2 \{\
.        nr % 0
.        nr F 2
.    \}
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "NINPATHS 8"
.TH NINPATHS 8 "2015-09-12" "INN 2.6.3" "InterNetNews Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
ninpaths \- Report Usenet Path: statistics (new inpaths)
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
\&\fBninpaths\fR \fB\-p\fR \fB\-d\fR \fIdumpfile\fR
.PP
\&\fBninpaths\fR \fB\-r\fR \fIsite\fR \fB\-u\fR \fIdumpfile\fR [\fB\-u\fR \fIdumpfile\fR ...] \fB\-v\fR
\&\fIlevel\fR
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
This is an efficient and space-saving \fBinpaths\fR reporting program.  It works
as follows:  you feed it the Path: lines via an \s-1INN\s0 channel feed or some
other similar method, and from time to time the program writes all its
internal counters accumulated so far to a dump file.  Another instance of
the program picks up all the dump files, adds them up and formats them
into the report.  The purpose of the final report is to summarize the
frequency of occurrence of sites in the Path: headers of articles.
.PP
Some central sites accumulate the Path: data from many news servers
running this program or one like it, and then report statistics on
the most frequently seen news servers in Usenet article Path: lines.
The \fBsendinpaths\fR script can be run daily to mail the accumulated
statistics to such a site and remove the old dump files.
.PP
You can get a working setup by doing the following:
.IP "1." 4
Create a directory at \fIpathlog\fR/path (replacing \fIpathlog\fR here and in
all steps that follow with the full path to your \s-1INN\s0 log directory).
Do not change the name of the \f(CW\*(C`path\*(C'\fR subdirectory because it is used
by \fBsendinpaths\fR.
.IP "2." 4
Set up a channel feed using an entry like:
.Sp
.Vb 1
\&    inpaths!:*:Tc,WP:<pathbin>/ninpaths \-p \-d <pathlog>/path/inpaths.%d
.Ve
.Sp
if your version of \s-1INN\s0 supports \f(CW\*(C`WP\*(C'\fR (2.0 and later all do).  Replace
<pathbin> with the full path to your \s-1INN\s0 binaries directory, and
<pathlog> with the full path to your \s-1INN\s0 log directory.
.Sp
Note that the naming convention of the generated inpaths dump files should
not be changed.  \fBsendinpaths\fR explicitly searches files whose name starts
with \f(CW\*(C`inpaths.\*(C'\fR in the <pathlog>/path directory.
.IP "3." 4
Run the following command to start logging these statistics:
.Sp
.Vb 1
\&    ctlinnd reload newsfeeds \*(Aqinpaths feed setup\*(Aq
.Ve
.IP "4." 4
Enter into your news user crontab these two lines:
.Sp
.Vb 2
\&    6   6 * * *   <pathbin>/ctlinnd flush inpaths!
\&    10  6 * * *   <pathbin>/sendinpaths
.Ve
.Sp
(the actual time doesn't matter).  This will force \fBninpaths\fR to generate
a dump file once a day.  Then, a few minutes later, \fBsendinpaths\fR collects
the dumps, makes a report, sends the collected statistics, and deletes
the old dumps.
.Sp
Note that you can manually generate a report without mailing it, and without
deleting processed dump files, with \f(CW\*(C`sendinpaths \-n\*(C'\fR.  Another useful
command is \f(CW\*(C`sendinpaths \-c\*(C'\fR so as to receive a copy of the e\-mail sent
by \fBsendinpaths\fR and therefore make sure that everything is properly set.
.IP "5." 4
In a couple of days, check that your daily statistics properly appear in
<http://top1000.anthologeek.net/>.
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\fB\-d\fR \fIdumpfile\fR" 4
.IX Item "-d dumpfile"
Save dumps in \fIdumpfile\fR.  Any \f(CW%d\fR in \fIdumpfile\fR will be replaced with
the current system time when the dump is made.  This option should be used
with \fB\-p\fR.
.Sp
The format of these dump files is described below.
.IP "\fB\-p\fR" 4
.IX Item "-p"
Read Path: lines from standard input.
.IP "\fB\-r\fR \fIsite\fR" 4
.IX Item "-r site"
Generate a report for \fIsite\fR.  Generally \fIsite\fR should be the value of
\&\fIpathhost\fR from \fIinn.conf\fR.
.IP "\fB\-u\fR \fIdumpfile\fR" 4
.IX Item "-u dumpfile"
Read data from \fIdumpfile\fR.  This option can be repeated to read data from
multiple dump files.
.IP "\fB\-v\fR \fIlevel\fR" 4
.IX Item "-v level"
Set the verbosity level of the report.  Valid values for \fIlevel\fR are \f(CW0\fR,
\&\f(CW1\fR, and \f(CW2\fR, with \f(CW2\fR being the default.
.SH "DUMP FILE FORMAT"
.IX Header "DUMP FILE FORMAT"
The format of the generated dump files is:
.PP
.Vb 5
\&   !!NINP <version> <start\-time> <end\-time> <nb\-sites> <nb\-articles> <average\-time>
\&   <site_0> <count_0> <site_1> <count_1> <site_2> <count_2> ...
\&   !!NLREC
\&   :<site_a>!<site_b>,<count_ab>:<site_c>!<site_d>,<count_cd> ...
\&   !!NEND <nb\-relations>
.Ve
.PP
where times are \s-1UNIX\s0 timestamps.  Then, \fInb-sites\fR records follow.
Each record is separated by a space or a new line, and consists of a host
name \fIsite_n\fR followed by a number of appearances \fIcount_n\fR.  The number
of processed Path: header lines is \fInb-articles\fR.
.PP
Afterwards, \fInb-relations\fR relations follow.  In 3.0.x versions, the
relations are separated by a space or a new line, and their syntax is
\&\f(CW\*(C`\f(CIsite_a\f(CW!\f(CIsite_b\f(CW!\f(CIcount_ab\f(CW\*(C'\fR where \fIsite_a\fR and \fIsite_b\fR
are numbers of the site records starting at 0.
.PP
In 3.1.x versions, the relations begin with a colon and are
separated by either nothing or a new line.  Their syntax is \f(CW\*(C`:\f(CIsite_a\f(CW!\f(CIsite_b\f(CW,\f(CIcount_ab\f(CW\*(C'\fR with the same meaning as in previous
versions.  The count can be omitted when it is \f(CW1\fR.  More than two sites can
be specified in the relation (\f(CW\*(C`:\f(CIsite_a\f(CW!\f(CIsite_b\f(CW!\f(CIsite_c\f(CW,\f(CIcount_abc\f(CW\*(C'\fR).
.PP
For instance:
.PP
.Vb 6
\&    !!NINP 3.1.1 1302944821 1302944838 5 2 1302944826
\&    newsgate.cistron.nl 1 news.trigofacile.com 2 news.ecp.fr 2 usenet.stanford.edu 1
\&    bleachbot 1
\&    !!NLREC
\&    :3!2:2!1,2:4!0:0!2
\&    !!NLEND 4
.Ve
.PP
where the two processed Path: headers are:
.PP
.Vb 2
\&    Path: news.trigofacile.com!news.ecp.fr!usenet.stanford.edu!not\-for\-mail
\&    Path: news.trigofacile.com!news.ecp.fr!newsgate.cistron.nl!bleachbot!not\-for\-mail
.Ve
.SH "NOTES"
.IX Header "NOTES"
If your \s-1INN\s0 doesn't have the \f(CW\*(C`WP\*(C'\fR feed flag (1.5 does not, 1.6 and 1.7 do,
2.0 and later all do), use the following \fInewsfeeds\fR entry:
.PP
.Vb 1
\&   inpaths!:*:Tc,WH:<pathbin>/ginpaths
.Ve
.PP
where \fBginpaths\fR is the following script:
.PP
.Vb 2
\&    #!/bin/sh
\&    exec egrep \*(Aq^Path: \*(Aq | <pathbin>/ninpaths \-p \-d <pathlog>/path/inpaths.%d
.Ve
.PP
replacing <pathbin> and <pathlog> as above.
.SH "HISTORY"
.IX Header "HISTORY"
This is a slightly modified version of Olaf Titz's original \fBninpaths\fR
program, which is posted to alt.sources and kept on his \s-1WWW\s0 archive under
<http://sites.inka.de/~bigred/sw/>.
.PP
The idea and some implementation details for \fBninpaths\fR come from the
original \fBinpaths\fR program, but most of the code has been rewritten for
clarity.  This program is in the public domain.
.PP
\&\f(CW$Id:\fR ninpaths.pod 9383 2011\-12\-25 20:56:10Z iulius $
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fInewsfeeds\fR\|(5), \fIsendinpaths\fR\|(8).
